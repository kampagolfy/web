
<!DOCTYPE html>

<html>

<head>
<meta charset="UTF-8"/>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/kampagolfy/web/refs/heads/main/list-square-rounded_solid.png" />
<title>MSL コンテンツエディター</title>



<style>

  .CodeMirror-gutters {
      background: #f7f7f7;
      border-right: 1px solid #ddd;
    }

    .custom-gutter {
      width: 5px;
    }

    .marker {
      color: rgb(34, 194, 243);
      font-size: 14px;
    }

    .highlighted-line {
      background-color: #ffffcc; /* Highlight color */
    }


/* CSS */
.highlighted {
  background-color: yellow;
}


.CodeMirror-selected {
  background-color: #87ceeb !important;
}

.cm-s-default .cm-tag { /* replace 'default' with the theme you're using */
  font-weight: bold;
font-style: oblique;

}

.inputhidden
{  
border: 0px;
border-color: "white";
width:0.5px;
height:0.5px;
outline: 0px solid transparent;
}

.CodeMirror {
  border: 1px solid #eee;
  height: 900px;
  resize: both;
  overflow: auto;
}

.rcorners2 {
  border-radius: 10px;
  border: 1px solid gray;
  padding: 10px; 
  font-family:Meiryo;
font-size: 14px; 
/*font-weight: 376;*/
height: auto;
}
 

.rcorners {
  border-radius: 10px;
  border: 1px solid gray;
  padding: 10px; 
font-family : Meiryo,Leelawadee UI;
font-size: 14px; 
font-weight: 376;
height: auto;
}

* {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  width:100%;
  height: 1000px;
}
.clearfix:after,
.clearfix:before {
  display: block;
  content: "";
  clear: both;
}
.container {
  width: 100%;
  height: 100%;
  background-color: #fff;
}
h1 {
  margin: 20px 0;
  font-size: 20px;
  text-align: center;
}
.my-contextmenu {
  
  display: none;
  position: fixed;
  width: 400px;
  background-color: #fff;
  border: 1px solid #ccc;
  box-shadow: 1px 1px 1px rgba(0,0,0,.2);
  z-index: 1000;
}
.my-contextmenu.show {
  display: block;
}
.my-contextmenu ul {
  list-style: none;
  padding: 10px 0;
}
.my-contextmenu ul li {
  padding: 4px 4px;
  font-size: 14px;
  color: #333;
}

 .tooltip {
            position: absolute;
            background: #333;
            color: #fff;
            border-radius: 4px;
            padding: 5px;
            font-size: 12px;
            display: none;
			max-width: 500px;
            word-wrap: break-word;
			z-index: 1000;
			
        }


.alert-box {
            background-color: #f8d7da;
			font-size:12px;
            color: #721c24;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
			text-align:center;
        }
        .alert-box.hide {
            opacity: 0;
        }
		
		
		.alert-box-green {
            background-color: #a3d6cc;
            color: black;
			font-size:12px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #a3d6cc;
            border-radius: 5px;
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
			text-align:center;
        }
        .alert-box-green.hide {
            opacity: 0;
        }


/*for link and image popup */

#content {
            width: 100%;
            height: 200px;
            margin-bottom: 20px;
        }
        .popup {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            z-index: 10;
            max-width: 600px;
            min-width: 600px;
            overflow-wrap: break-word;
            font-size:15px;
            font-weight: normal;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);

        }
        .popup ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        #linkList li, #imgList li {
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ccc;
            overflow-x: auto;
        }
        .popup img {
            max-width: 100px;
            height: auto;
            display: inline-block;
            
        }
        #linkContainer:hover #linkPopup,
        #imgContainer:hover #imgPopup {
            display: block;
        }

        /* --------------------------------- */
</style>



</head>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css" />

<!link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.1/codemirror.min.css" />
<!link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/theme/monokai.min.css"/>
<!link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/theme/dracula.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.3/theme/night.min.css"/>
 <link rel="stylesheet" href="https://codemirror.net/5/addon/fold/foldgutter.css" />

<!script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.1/codemirror.min.js"><!/script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.1/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.1/mode/xml/xml.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.css">

 <script src="https://codemirror.net/5/addon/fold/foldcode.js"></script>
  <script src="https://codemirror.net/5/addon/fold/foldgutter.js"></script>
  <script src="https://codemirror.net/5/addon/fold/brace-fold.js"></script>
  <script src="https://codemirror.net/5/addon/fold/xml-fold.js"></script>
  <script src="https://codemirror.net/5/addon/fold/indent-fold.js"></script>
  <script src="https://codemirror.net/5/addon/fold/markdown-fold.js"></script>
  <script src="https://codemirror.net/5/addon/fold/comment-fold.js"></script>
  <script src="https://codemirror.net/5/mode/javascript/javascript.js"></script>
  <script src="https://codemirror.net/5/mode/xml/xml.js"></script>
  <script src="https://codemirror.net/5/mode/css/css.js"></script>
  <script src="https://codemirror.net/5/mode/htmlmixed/htmlmixed.js"></script>
  <script src="https://codemirror.net/5/mode/python/python.js"></script>
  <script src="https://codemirror.net/5/mode/markdown/markdown.js"></script>




<body onContextmenu="return false;" onload="closepostit();"  >


  <br>
  <style>
@import url('https://fonts.googleapis.com/css2?family=Kaisei+Decol:wght@400;500;700&family=Zen+Maru+Gothic:wght@300;400;500;700;900&display=swap');
.zen-maru-gothic {
  font-family: "Zen Maru Gothic", system-ui;
  font-weight: 700;
  font-style: normal;
  font-size:28px;
  }
  
 button
 {
  font-family: "Zen Maru Gothic", system-ui;
  font-weight: 400;
 } 
</style>
<center>

<div class="zen-maru-gothic">MSL コンテンツエディター</div>

<div class="zen-maru-gothic" style=" font-weight: 400;">
<font size="2">
<a href="https://wiki.workers-hub.com/download/attachments/290109220/contenteditor.html" target="_blank">最新版ダウンロード</a> / 
<a href="https://wiki.workers-hub.com/pages/viewpage.action?pageId=290109220" target="_blank">ツールのwiki</a> / <a href="https://wiki.workers-hub.com/pages/viewpage.action?pageId=233308478" target="_blank">ヘルプチームの運用ガイドライン</a></font>
<br>

<iframe id="iframe_head" scrolling="no" style="border:0;" src="https://kampagolfy.github.io/web2/" width="70%" height="30"></iframe>

</div>


<div id="tooltip" class="tooltip"></div>



<div id="mydiv" class="rcorners">
<div onclick="closepostit()" id="closepostit" style="text-align: right;">Ⓧ</div><div onclick="makeinserttext()">≡</div>
  <div id="mydivheader">メモ</div>
  <p><textarea id="inserttextarea" cols="40" rows="10" style="padding: 10px 10px;"></textarea></p>

</div>

<div class="my-contextmenu" id="js-contextmenu" >
<table border="0" cellpadding="1" cellspacing="1" style="font-size: 10px;">
	<tbody>
		<tr>
			<td style='vertical-align:top ;width:200px'><b>原文欄用</b></td>
			<td style='vertical-align:top ;width:200px'><b>プレビュー欄用</b></td>
		</tr>
		<tr>
			<td style='vertical-align:top'>

<button onclick="makebold()">Bold</button><br><br>
<button onclick="midashi16()">見出し①16</button>
<button onclick="midashi14()">見出し②14</button>
<button onclick="midashi12()">見出し③12</button>
<br><br>

セク:注意 <button onclick="makesection_ja_text_chuui()" title="セクション化したい部分を選択してからこのボタンをクリック">JA</button>
 <button onclick="makesection_th_text_chuui()" title="セクション化したい部分を選択してからこのボタンをクリック">TH</button>
 


<br>
セク:参考 <button onclick="makesection_ja_text_sankou()" title="セクション化したい部分を選択してからこのボタンをクリック">JA</button>
 <button onclick="makesection_th_text_sankou()" title="セクション化したい部分を選択してからこのボタンをクリック">TH</button>

<br><br>
 <button onclick="acco()" title="アコーディオン1重をタイトルを選択してこのボタンをクリック">アコ冒頭1重</button>
 <button onclick="document.execCommand('insertText', false, '{end1}');" title="アコーディオン1終了ポイント">end1</button><br>

 <button onclick="acco2()"  title="アコーディオン2重をタイトルを選択してこのボタンをクリック">アコ冒頭2重</button>
 <button onclick="document.execCommand('insertText', false, '{end2}');" title="アコーディオン2終了ポイント">end2</button><br>

 <button onclick="acco3()" title="アコーディオン3重をタイトルを選択してこのボタンをクリック">アコ冒頭3重</button>
 <button onclick="document.execCommand('insertText', false, '{end3}');" title="アコーディオン3終了ポイント">end3</button><br><br>

 <button onclick="document.execCommand('insertText', false, '{┌----------------------2start----------------------┐}');">アコ2重start</button>
 <button onclick="document.execCommand('insertText', false, '{└----------------------2end----------------------┘}');">アコ2重end</button><br>
 <button onclick="document.execCommand('insertText', false, '{┌----------------------3start----------------------┐}');">アコ3重start</button>
 <button onclick="document.execCommand('insertText', false, '{└----------------------3end----------------------┘}');">アコ3重end</button><br><br>
</td>
			<td style='vertical-align:top'>
<button>リンク</button> <button onclick="link2()">リンクターゲット</button>


<button onclick="document.execCommand('forecolor', false,'#00B050');editor.setValue(document.getElementById('Preview_p').innerHTML);">グリーン</button>
<button onclick="document.execCommand('backcolor', false,'yellow');editor.setValue(document.getElementById('Preview_p').innerHTML);">黄色ペン</button>
<button onclick="document.execCommand('insertHTML', false, '<br>');editor.setValue(document.getElementById('Preview_p').innerHTML);">br挿入</button>
<button onclick="torikeshi();">取り消し線</button>
<button onclick="futoji();">太字</button>
<button onclick="futojispanblack();">太字黒</button>
<!--button onclick="makesection_ja()">セクション挿入(JA)</button><br-->
<!--button onclick="makesection_ko()">セクション挿入(KO)</button> <br-->
<button onclick="list()">リスト</button> <button onclick="shousaisakujo()">▼詳細削除</button><br>
<button onclick="removeAllStylesAndCleanUp()">remove span and css</button>
<button onclick="fontred()">赤字</button><br>
<button onclick="shinsection()">新セク化</button>
<button onclick="THka()">TH化</button>
<br>


<br>
<br>
<b>HTML欄用</b><br>
<button onclick="TextCopy_selected()">選択コピー</button><br><br>

<b>Image関連</b><br>
<button onclick="imagecopy()">imgコードのみコピー</button><br>

</td>
		</tr>
	</tbody>
</table>
</div>
    
    
<table border="0" cellpadding="15" cellspacing="10">
	<tbody>
		</tr>
			<td style='vertical-align:top;'></td>
			<td style='vertical-align:top ;width:700px'></td>
			<td style='vertical-align:top ;width:400px'></td>
		</tr>
		<tr>
			<td style='vertical-align:top ;' ><b class="zen-maru-gothic"><font size=3>原文 <button style="font-size:6px;" id="genbundivbutton" onclick="genbunclose()">×</button>   &nbsp;&nbsp;<span id="mojisuu" style="color:gray;font-size:12px;"></span></font> 
</b><hr><p class="zen-maru-gothic" style="font-size:8px;color:white">.</p>
			<div id="genbundiv" >
			<button onclick="jidouka()" title="アコーディオンの冒頭に設定するには、{{title}} を入れてください。
終了するところは{end}を入れてください">自動化</button>
 
			 <button onclick="kaigyoukatto()">改行カット</button> <button id="toggleButton2">置換</button> <button onclick="openpostit()">メモ</button> <button id="replaceButton">自動翻訳反映</button>
			 </button> <button id="replaceButtonshudou">手動翻訳反映</button>
			 
			 <button onclick="gyazohozon()">Gyazo保存</button>
			 			 
			 <span id="searchdiv2" style="display: none;" ><input id="search2" placeholder="Search..."> <input id="replace2" placeholder="Replace..."> <button onclick="search_replace2()">OK</button>
			 </span>
			 			 
			 <br><br>

<!★Text-textarea>

			<textarea  style="display: block;line-height: 26.5px; display: block;line-height: 26.5px;width: 650px;height:1000px" onmousemove="mouseposition(event)" class="rcorners2" id="Text_textarea" onKeyPress="mojisuukei()" onKeyDown="mojisuukei()" onKeyUp="mojisuukei()" ></textarea></textarea>
			
			</div>
			
			</td>

			<td style='vertical-align:top ;width:700px'><b class="zen-maru-gothic"><font size=3>プレビュー</font><hr></b>
			<button onclick="texttoHTML()">HTML更新 ▶</button> <button id="link-button">リンク</button>
			<button onclick="link2()">リンクターゲット</button>
			<button onclick="Preview()">プレビュー</button> 

<button onclick="clearformat()" title="選択してクリックするとフォーマットクリアします。<br>タグ以外は削除されます">クリア</button>
<button onclick="fontsizechange()" title="見出しを設定したい文字列を選択してからクリック">見出し</button>
<button onclick="fontsizechange_underline()" title="見出し+下線を設定したい文字列を選択してからクリック">見出し+下線</button>
<button onclick="insertselectHTML()">HTML挿入</button>
<button id="acoopen-close" onclick="acoopenclose()" title="クリックしてアコーディオンを全部展開/縮小ができる">アコ全展開</button>

<!--button onclick="copytojira()" title="Jiraでは、ハイフンは自動的に ・ になる。これでJira用のハイフンに変更。">Jira用ハイフン</button>-->
<!--button onclick="copyRichText()">コピー</button-->
			<br><br>

<!★Preview_p>
			<div style="height:1000px; min-height:1000px; min-width:720px; overflow: auto; resize: both;font-size:15px"onmousemove="mouseposition(event);" class="rcorners"  id="Preview_p" contenteditable=true></div>
<br>

<br>

</td>

			<td style='vertical-align:top ;'><b class="zen-maru-gothic"><font size=3>HTML</font>&nbsp;&nbsp;
<!-- link list -->
        <div id="linkContainer" style="position:relative; display:inline-block;">
          <span id="urlcount" style="font-size:15px">0</span>
                  <svg id="linkIcon" xmlns="http://www.w3.org/2000/svg" data-laicon-version="15.0" viewBox="0 0 20 20" width="20" height="20" fill="currentColor"><g transform="translate(-2 -2)"><path d="M12.0344 4.293c-2.1342-2.1343-5.5945-2.1343-7.7287 0-2.1342 2.1342-2.1342 5.5944 0 7.7286l2.3618 2.3618a5.601 5.601 0 0 0 .2401.2263 6.703 6.703 0 0 1-.0072-2.2561l-1.4633-1.4633c-1.5094-1.5094-1.5094-3.9566 0-5.466 1.5094-1.5093 3.9566-1.5093 5.4659 0l2.3617 2.3618c1.5094 1.5093 1.5094 3.9565 0 5.4659a3.8478 3.8478 0 0 1-2.3007 1.1079c.1286.3596.3369.6971.6249.9851l.433.433c.8694-.2455 1.69-.7104 2.3742-1.3946 2.1342-2.1342 2.1342-5.5945 0-7.7287L12.0344 4.293Z"></path><path d="M11.9832 8.2016c-.8694.2455-1.69.7104-2.3742 1.3947-2.1342 2.1342-2.1342 5.5944 0 7.7286l2.3617 2.3618c2.1342 2.1342 5.5944 2.1342 7.7287 0 2.1342-2.1342 2.1342-5.5945 0-7.7287l-2.3618-2.3618a5.5163 5.5163 0 0 0-.2401-.2262 6.7014 6.7014 0 0 1 .0072 2.2561l1.4633 1.4633c1.5094 1.5093 1.5094 3.9565 0 5.4659-1.5094 1.5094-3.9566 1.5094-5.4659 0l-2.3618-2.3617c-1.5093-1.5094-1.5093-3.9566 0-5.466a3.8492 3.8492 0 0 1 2.3008-1.108 2.6544 2.6544 0 0 0-.6249-.985l-.433-.433Z"></path></g></svg>
          
          <div id="linkPopup" class="popup">
              <ul id="linkList"></ul>
          </div>
      </div>
  
      &nbsp;
  <!-- image list -->
      <div id="imgContainer" style="position:relative; display:inline-block;">
          <span id="imgcount" style="font-size:15px">0</span>
          
          <svg id="imgIcon" xmlns="http://www.w3.org/2000/svg" data-laicon-version="15.0" viewBox="0 0 20 20" width="20" height="20" fill="currentColor"><g transform="translate(-2 -2)"><path d="M4.7507 4.75v14.5h14.499V4.75H4.7507Zm-1.3-.15c0-.6351.5149-1.15 1.15-1.15h14.799c.6351 0 1.15.5149 1.15 1.15v14.8c0 .6351-.5149 1.1499-1.15 1.1499H4.6007c-.6351 0-1.15-.5148-1.15-1.1499V4.6Z"></path><path d="M14.0571 9.5268c0-.5936.4824-1.0748 1.0775-1.0748s1.0775.4812 1.0775 1.0748c0 .5935-.4824 1.0748-1.0775 1.0748s-1.0775-.4812-1.0775-1.0748ZM7.69 15.511l3.8388-5.9841 3.8388 5.9841H7.6899Z"></path></g></svg>
          
          
          
          
          <div id="imgPopup" class="popup">
              <ul id="imgList"></ul>
          </div>
      </div>
        
        <hr></b>
			<div style="display: inline-block"><button onclick="htmlhanei()">◀ 反映</button> <button onclick="kaigyou_seiri()">改行整理</button>
			
 
 <button id="themeButton">ダークテーマ</button> 
 <button id="brchangebutton" onclick="brchange()">&lt;br/&gt;に変更</button>
<button onclick="editor.execCommand('find');" title="Ctrl-F:Start searching
Ctrl-G:Find next
Shift-Ctrl-G :Find previous
Shift-Ctrl-F:Replace
Shift-Ctrl-R:Replace all"
>サーチ</button>  <button onclick="editor.execCommand('replace');">リプレース</button> 
 <button id="foldbtn" onclick="foldall()">フォルド</button>
  <button onclick="extractFromTextarea()">コード詳細</button>
 <button onclick="TextCopy()">コピー</button>
 <input name="realtime" type="checkbox" hidden/>
 </div>

			<br><br>
<!★editor>
			<textarea onmousemove="mouseposition(event);" class="rcorners"  id="editor" onKeyPress="jidouhanei()" onKeyDown="jidouhanei()" onKeyUp="jidouhanei()" ></textarea>
			<p style="text-align:right;"><textarea id="HTML_textarea" class="inputhidden" cols=0 rows=0 ></textarea></p>
			
			</td>
		</tr>
	</tbody>
</table>

<script>




//LINK code

          function showTooltip(content, event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = content;
            tooltip.style.left = `${event.pageX}px`;
            tooltip.style.top = `${event.pageY + 10}px`;
            tooltip.style.display = 'block';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        }

        
        function addEventListenersToContent() {
          
          // Adding to links
          document.querySelectorAll('#Preview_p a').forEach(anchor => {
                
                anchor.addEventListener('mouseover', function(e) {
                    // Decode the URL for tooltip display
                    showTooltip(decodeURIComponent(anchor.href), e);
                });
                anchor.addEventListener('mouseout', hideTooltip);
            });

            // Adding events to images
            document.querySelectorAll('#Preview_p img').forEach(image => {
                image.addEventListener('mouseover', function(e) {
                    if (image.alt) {
                        showTooltip(image.alt, e);
                    }
                });

                image.addEventListener('mouseout', hideTooltip);

                  // Double-click to change alt attribute
                image.addEventListener('dblclick', function() {
                    const newAlt = prompt("Enter new alt text:", image.alt);
                    if (newAlt !== null) {
                        image.alt = newAlt;
						editor.setValue(document.getElementById('Preview_p').innerHTML);
                    }
                });
            });
        }
					

        document.addEventListener('DOMContentLoaded', addEventListenersToContent);







//★★★★★★★★★Editor★★★★★★★★★★★★★★//★★★★★★★★★Editor★★★★★★★★★★★★★★//★★★★★★★★★Editor★★★★★★★★★★★★★★
//★★★★★★★★★Editor★★★★★★★★★★★★★★//★★★★★★★★★Editor★★★★★★★★★★★★★★//★★★★★★★★★Editor★★★★★★★★★★★★★★
//★★★★★★★★★Editor★★★★★★★★★★★★★★//★★★★★★★★★Editor★★★★★★★★★★★★★★//★★★★★★★★★Editor★★★★★★★★★★★★★★


editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
  lineNumbers: true,
  mode: "text/html",
  htmlMode: true,
  theme: "default",
   //theme: "monokai",
  lineWrapping: true, 
matchBrackets: true,
gutters: ["custom-gutter", "CodeMirror-linenumbers", "CodeMirror-foldgutter"], // Ensure correct order
      foldGutter: true,
      extraKeys: {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); }}

    		
	
});

 // Add click event listener to the editor
 editor.on('gutterClick', function(cm, line) {
      toggleMarker(cm, line);
    });

    function makeMarker() {
      var marker = document.createElement("div");
      marker.classList.add('marker');
      marker.innerHTML = "📍"; // Symbol for the marker
      return marker;
    }

    function toggleMarker(cm, line) {
      var info = cm.lineInfo(line);
      if (info.gutterMarkers && info.gutterMarkers['custom-gutter']) {
        cm.setGutterMarker(line, 'custom-gutter', null); // Remove the marker
        cm.removeLineClass(line, 'background', 'highlighted-line'); // Remove highlight

      } else {
        cm.setGutterMarker(line, 'custom-gutter', makeMarker()); // Add a marker
        cm.addLineClass(line, 'background', 'highlighted-line'); // Add highlight
      }
    }


    



function foldall()
{

var btn=document.getElementById("foldbtn");
  if (btn.innerHTML === "フォルド") {
        btn.innerHTML = "アンフォルド";
		editor.execCommand("foldAll");
  } else {
        btn.innerHTML = "フォルド";
		editor.execCommand("unfoldAll");
		
  }

}


editor.setOption("extraKeys", {
  "Ctrl-Y": cm => CodeMirror.commands.foldAll(cm),
  "Ctrl-I": cm => CodeMirror.commands.unfoldAll(cm),
  
})


//editor.setSize(null, "1000px");
editor.setSize("700px", "1000px");


editor.on("keypress", function() {
  var preview = document.getElementById("Preview_p");
  preview.innerHTML = editor.getValue();
   addEventListenersToContent();
   updateCounts()

});

editor.on("keyup", function() {
  var preview = document.getElementById("Preview_p");
  preview.innerHTML = editor.getValue();
   addEventListenersToContent();
   hideTooltip();
   updateCounts()
});

editor.on("keydown", function() {
  var preview = document.getElementById("Preview_p");
  preview.innerHTML = editor.getValue();
   addEventListenersToContent();
   hideTooltip();
   updateCounts()
});

editor.on("mouseover", function() {
  var preview = document.getElementById("Preview_p");
  preview.innerHTML = editor.getValue();
  hideTooltip();
  updateCounts()
});

document.getElementById("Preview_p").addEventListener("keypress", function() {
  editor.setValue(this.innerHTML);
   hideTooltip();
  //addEventListenersToContent();
});

document.getElementById("Preview_p").addEventListener("keyup", function() {
  editor.setValue(this.innerHTML);
   hideTooltip();
  //addEventListenersToContent();
});

document.getElementById("Preview_p").addEventListener("keydown", function() {
  editor.setValue(this.innerHTML);
   hideTooltip();
  //addEventListenersToContent();
});

document.getElementById("Preview_p").addEventListener("mousedown", function() {
  editor.setValue(this.innerHTML);
   hideTooltip();
  //addEventListenersToContent();
});



editor.getWrapperElement().addEventListener("resize", function() {
  editor.setSize(this.style.width, this.style.height);
});
//-------------------change theme------------------------


var themeButton = document.getElementById("themeButton");

// Add an event listener to the button
themeButton.addEventListener('click', function() {
  // Get the current theme
  var currentTheme = editor.getOption("theme");

  // Switch the theme
  if (currentTheme == "default") {
    editor.setOption("theme", "night");
	themeButton.innerHTML="ノーマルテーマ"
  } else {
    editor.setOption("theme", "default");
	themeButton.innerHTML="ダークテーマ"
  }
});



//-----------------------highlight---------------------

var previewWindow = document.getElementById("Preview_p");

// Listen for the selection event in the preview window
previewWindow.addEventListener('mouseup', function() {
  
  //var selectedText = window.getSelection().toString();
  var selectedText = getSelectedHtml().toString();
  

  // Find the location of the selected text in the source code
  var sourceCode = editor.getValue();
  var startIndex = sourceCode.indexOf(selectedText);
  var endIndex = startIndex + selectedText.length;

  // Convert the start and end indices to CodeMirror positions
  var startPos = editor.posFromIndex(startIndex);
  var endPos = editor.posFromIndex(endIndex);

  // Highlight the corresponding source code in the CodeMirror instance
  editor.setSelection(startPos, endPos);
});


//--------------------------input search text highlight-------------------------------------

//------------------------------------------------------------------

//var isDivVisible = false;
//var div = document.getElementById('searchdiv');
//var btn = document.getElementById('toggleButton');

//btn.onclick = function() {
 // if (isDivVisible) {
   // div.style.display = 'none';
  //} else {
    //div.style.display = 'inline-block';
  //}
  //isDivVisible = !isDivVisible;
//};


var isDivVisible2 = false;
var div2 = document.getElementById('searchdiv2');
var btn2 = document.getElementById('toggleButton2');

btn2.onclick = function() {
  if (isDivVisible2) {
    div2.style.display = 'none';
  } else {
    div2.style.display = 'inline-block';
  }
  isDivVisible2 = !isDivVisible2;
};

//---------

 function gyazohozon(){
 
 var gyazo=document.getElementById("Text_textarea").value;
 var gyazo=gyazo.replace(/http/g,"<img src=\"http");
 var gyazo=gyazo.replace(/png/g,"png\"</img><br>");
 //document.getElementById("Text_textarea").value=gyazo;
 editor.setValue(gyazo);
 document.getElementById("Preview_p").innerHTML=editor.getValue();
 
  }




function search_replace()
{
var a=document.getElementById("search").value;
var b=document.getElementById("replace").value;
var c=document.getElementById("HTML_textarea").value=editor.getValue();
var c= c.replace(new RegExp(a,"g"),b);
editor.setValue(c);
}

function search_replace2()
{
var a=document.getElementById("search2").value;
var b=document.getElementById("replace2").value;
var c=document.getElementById("Text_textarea").value;
var c= c.replace(new RegExp(a,"g"),b);
document.getElementById("Text_textarea").value=c;

}


//------------------------------------------------------------




//------------------------Copy to Jira------------------------------------
function copytojira()
{
//hyphen for jira
var a=document.getElementById("Preview_p").innerHTML;
var a=a.replace(/-/g,"&#8208;");

document.getElementById("Preview_p").innerHTML=a;

//-----------------
}



//------------------------------------------------------------

function acoopenclose()
{
	var btn=document.getElementById("acoopen-close");
  if (btn.innerHTML === "アコ全展開") {
        btn.innerHTML = "アコ全縮小";
		var a=editor.getValue();
		var a=a.replace(/<details>/g,"<details open=\"\">")
		 editor.setValue(a);
		 document.getElementById("Preview_p").innerHTML=editor.getValue();
		 addEventListenersToContent();
  } else {
        btn.innerHTML = "アコ全展開";
		var a=editor.getValue();
		var a=a.replace(/<details open=\"\">/g,"<details>")
		 editor.setValue(a);
		 document.getElementById("Preview_p").innerHTML=editor.getValue();
		 addEventListenersToContent();
		
  }
}

function genbunclose()
{
	var btn=document.getElementById("genbundivbutton");
	var a=document.getElementById("genbundiv");
	var b=document.getElementById("mojisuu");
  if (btn.innerHTML === "×") {
        btn.innerHTML = "⇔";
		a.style.display = "none";
		b.innerHTML="";
		//b.style.visibility= "hidden";
		//b.style.display = "none";
		
  } else {
        btn.innerHTML = "×";
		a.style.display = "block";
		//b.style.display = "block";
		mojisuukei();
		//b.style.visibility= "visible";
		
		
  }
}



function brchange()
{


	var btn=document.getElementById("brchangebutton");
  if (btn.innerHTML === "&lt;br /&gt;に変更") {
        btn.innerHTML = "&lt;br&gt;に変更";
		var a=editor.getValue();
		var a=a.replace(/<br>/g,"<br/>")
		 editor.setValue(a);
		 document.getElementById("Preview_p").innerHTML=editor.getValue();
  } else {
        btn.innerHTML = "&lt;br /&gt;に変更";
		var a=editor.getValue();
		var a=a.replace(/<br\/>/g,"<br>")
		 editor.setValue(a);
		 document.getElementById("Preview_p").innerHTML=editor.getValue();
		
  }
}



function torikeshi()
{


var html = getSelectedHtml();
var selObj2 = '<s>'+html+"</s>"; 

//var selObj = window.getSelection(); 
//var selObj2 = selObj;

document.execCommand('insertHTML', false, selObj2);

editor.setValue(document.getElementById("Preview_p").innerHTML);

}


function futoji()
{

var html = getSelectedHtml();
var selObj2 = '<b>'+html+"</b>"; 

//var selObj = window.getSelection(); 
//var selObj2 = selObj;

document.execCommand('insertHTML', false, selObj2);

editor.setValue(document.getElementById("Preview_p").innerHTML);

}

function fontred()
{

var html = getSelectedHtml();
var selObj2 = '<font color=Red>'+html+"</font>"; 

//var selObj = window.getSelection(); 
//var selObj2 = selObj;

document.execCommand('insertHTML', false, selObj2);

editor.setValue(document.getElementById("Preview_p").innerHTML);

}




function futojispanblack()
{
var selObj = getSelectedHtml();

var selObj2 = '<b>ccc'+selObj+"ddd</b>"; 
document.execCommand('styleWithCSS', false, true);
document.execCommand('insertHTML', false, selObj2);

//document.execCommand('styleWithCSS', false, true);
//document.execCommand('foreColor', false, "rgb(0,0,0)")
//document.execCommand("fontSize", false, b);
editor.setValue(document.getElementById("Preview_p").innerHTML);

var a=editor.getValue();
var a=a.replace(/ccc/g,"<span style=\"color:rgb\(0\,0\,0\);\">");
var a=a.replace(/ddd/g,"</span>");
document.getElementById("Preview_p").innerHTML=a;

editor.setValue(a);
//editor.setValue(document.getElementById("Preview_p").innerHTML);

}




function insertselectHTML()
{
b=prompt("挿入したいHTMLを貼り付けてください。","");

document.execCommand('insertHTML', false, b);

editor.setValue(document.getElementById("Preview_p").innerHTML);
}



function getSelectedHtml() {
    let html = "";
    if (typeof window.getSelection != "undefined") {
        let sel = window.getSelection();
        if (sel.rangeCount) {
            let container = document.createElement("div");
            for (let i = 0, len = sel.rangeCount; i < len; ++i) {
                container.appendChild(sel.getRangeAt(i).cloneContents());
            }
            html = container.innerHTML;
        }
    } else if (typeof document.selection != "undefined") {
        if (document.selection.type == "Text") {
            html = document.selection.createRange().htmlText;

        }
    }
    return html;
}

function removeHtmlTagsExceptBr(html) {
    return html.replace(/<(?!br\s*\/?)[^>]+>/g, '');
}

function makeinserttext()
{
var a=document.getElementById("inserttextarea").value;
var a=a.replace(/\n</g,"\n<b><");
var a=a.replace(/>\n/g,"></b>\n");
var a=a.replace(/\n/g,"<br>\n");
var a=a.replace(/"/g,"</b>\"");
var a=a.replace(/ <\/b>"/g," \"<b>");
var a=a.replace(/\( \)/g,"\(&nbsp; \)");

document.getElementById("inserttextarea").value=a;

}


function getSelectedText() {
    let text = "";
    if (typeof window.getSelection != "undefined") {
        text = window.getSelection().toString();
    } else if (typeof document.selection != "undefined" && document.selection.type == "Text") {
        text = document.selection.createRange().text;
    }
    return text;
}


function fontsizechange_underline()
{
var b=prompt("見出し+下線設定の例: 設定部分を選択し、フォントサイズ12や16だけの入力し、Enter押す\n見出し1 : 16\n見出し2 : 14\n見出し3 : 12","");

var selObj = window.getSelection(); 
document.execCommand('styleWithCSS', false, true);
var selObj2 = '<b><span style="font-size:'+b+'pt;'+' colorrgb;"><u>'+selObj+"</u></span></b>"; 
document.execCommand('insertHTML', false, selObj2);

//document.execCommand('styleWithCSS', false, true);
//document.execCommand('foreColor', false, "rgb(0,0,0)")
//document.execCommand("fontSize", false, b);
editor.setValue(document.getElementById("Preview_p").innerHTML);

var a=editor.getValue();
var a=a.replace(/colorrgb/g,"color:rgb\(0\,0\,0\)");
document.getElementById("Preview_p").innerHTML=a;

editor.setValue(a);
//editor.setValue(document.getElementById("Preview_p").innerHTML);



}

function fontsizechange()
{
var b=prompt("見出し設定の例: 設定部分を選択し、フォントサイズ12や16だけの入力し、Enter押す\n見出し1 : 16\n見出し2 : 14\n見出し3 : 12","");

var selObj = window.getSelection(); 
document.execCommand('styleWithCSS', false, true);
var selObj2 = '<b><span style="font-size:'+b+'pt;'+' colorrgb;">'+selObj+"</span></b>"; 
document.execCommand('insertHTML', false, selObj2);

//document.execCommand('styleWithCSS', false, true);
//document.execCommand('foreColor', false, "rgb(0,0,0)")
//document.execCommand("fontSize", false, b);
editor.setValue(document.getElementById("Preview_p").innerHTML);

var a=editor.getValue();
var a=a.replace(/colorrgb/g,"color:rgb\(0\,0\,0\)");
document.getElementById("Preview_p").innerHTML=a;

editor.setValue(a);
//editor.setValue(document.getElementById("Preview_p").innerHTML);



}




function clearformat()
{

var html = getSelectedHtml();
var text = getSelectedText();
var result = removeHtmlTagsExceptBr(html);
var  a=text.replace(/\n/g, '<br>');

//var selObj = window.getSelection(); 
//var selObj2 = selObj;

//document.execCommand('insertHTML', false, selObj2);
//document.execCommand('insertHTML', false, result);
document.execCommand('insertHTML', false, a);

editor.setValue(document.getElementById("Preview_p").innerHTML);
}

function kaigyou_seiri()
{
var a=editor.getValue();
//reset all
var a=a.replace(/\n/g,"")
var a=a.replace(/			/g,"")
var a=a.replace(/    /g,"")
var a=a.replace(/		/g,"")


//table
var a=a.replace(/<tbody>/g,"\n<tbody>")
var a=a.replace(/<tr>/g,"\n		<tr>\n")
var a=a.replace(/<td>/g,"<td>\n")
var a=a.replace(/<\/td>/g,"</td>")
var a=a.replace(/<\/tr>/g,"\n		</tr>")

//<!--

var a=a.replace(/<!--/g,"\n<!--")
var a=a.replace(/-->/g,"-->\n")

//font
var a=a.replace(/<font color="#000000">/g,"\n<font color=\"#000000\">")
var a=a.replace(/<\/font>/g,"</font>\n")

    
//div
var a=a.replace(/<\/div>/g,"</div>\n")




//
var a=a.replace(/<br>/g,"<br>\n")
var a=a.replace(/<br \/>/g,"<br \/>\n")
var a=a.replace(/<br\/>/g,"<br\/>\n")


//アコーディオン
//var a=a.replace(/<b><span/g,"			<b><span")

var a=a.replace(/<details>/g,"<details>\n")
var a=a.replace(/<\/details>/g,"<\/details>\n")

var a=a.replace(/<summary><b><span style=/g,"		<summary>\n			<b><span style=")

//var a=a.replace(/<summary>/g,"		<summary>\n")

var a=a.replace(/<div style=\"text-align:/g,"			<div style=\"text-align:")

var a=a.replace(/<\/summary>/g,"\n		<\/summary>\n")

var a=a.replace(/<summary><span style=/g,"		<summary>\n			<span style=")


var a=a.replace(/-->/g,"-->\n")




editor.setValue(a);
document.getElementById("Preview_p").innerHTML=editor.getValue();
}


function Preview()
{
var a=document.getElementById("Preview_p").innerHTML;
var myWindow = window.open("", "MsgWindow", "width=800,height=900");
myWindow.document.write("<title>コンテンツプレビュー</title>"+a);
}

function TextCopy_selected()
{
var selectedText = editor.getSelection();
navigator.clipboard.writeText(selectedText)
}

function imagecopy()
{
	document.getElementById("HTML_textarea").value=editor.getValue();
	     
		 const input = document.getElementById('HTML_textarea').value;
            const match = input.match(/<img src="([^"]+)" alt="">/);

            if (match && match[1]) {
                navigator.clipboard.writeText(match[1])
                    .then(() => showAlertgreen("イメージコードをコピーしました"))
                    .catch(err => showAlert('コピーに失敗しました: ' + err));
            } else {
                showAlert("有効なイメージコードが見つかりません");
            }
			
        }
		
					
  function showAlert(message) {
            const alertBox = document.createElement('div');
            alertBox.className = 'alert-box';
            alertBox.innerText = message;

            document.body.appendChild(alertBox);

            setTimeout(() => {
                alertBox.classList.add('hide');
                setTimeout(() => {
                    alertBox.remove();
                }, 500); // Wait for the fade-out transition to complete
            }, 1000); // Display for 5 seconds
        }
		
		function showAlertgreen(message) {
            const alertBox = document.createElement('div');
            alertBox.className = 'alert-box-green';
            alertBox.innerText = message;

            document.body.appendChild(alertBox);

            setTimeout(() => {
                alertBox.classList.add('hide');
                setTimeout(() => {
                    alertBox.remove();
                }, 500); // Wait for the fade-out transition to complete
            }, 1000); // Display for 5 seconds
        }
  			
			
			

function TextCopy()
{
    document.getElementById("HTML_textarea").value=editor.getValue();
	document.getElementById("HTML_textarea").select();
    document.execCommand('copy');
editor.execCommand("selectAll");
showAlertgreen("コードをコピーしました");
	

	
}

function makebold()
{
var selObj = window.getSelection(); 
var text="<b>"+selObj+"</b>";
document.execCommand('insertText', false, text);
}

//function makesection_ko()
//{
//var selObj = window.getSelection(); 
//var text="<div style='padding: 10px; margin-bottom: 10px; border: 1px solid #FF6666; background-color: rgba\(255,0,0,0.1\);'><b><font //color='#ff0000'>※주의 사항※</font><br></b>"+"<font color= '#000000'>"+selObj+"</font></div>";
//document.execCommand('insertHTML', false, text);
//}

//function makesection_ko_text()
//{
//var selObj = window.getSelection(); 
//var a=selObj.split("\n");
//var text="{section start-ko}\n"+selObj+"\n{section end-ko}\n";
//document.execCommand('insertText', false, text);
//}

//function makesection_ja()
//{
//var selObj = window.getSelection(); 
//var text="<div style='padding: 10px; margin-bottom: 10px; border: 1px solid #FF6666; background-color: rgba\(255,0,0,0.1\);'><b><font color='#ff0000'>注意:</font><br></b>"+"<span style='color: #ff0000;'>"+selObj+"</span></div>";
//document.execCommand('insertHTML', false, text);
//}


//■■■■■■■■■■■■SECTIONS■■■■■■■■■■■■■■■■■

function makesection_ja_text_chuui()
{
var selObj = window.getSelection(); 
//var a=selObj.split("\n");
var text="{section start-ja-注意}\n"+selObj+"\n{section chuui end-ja}\n";
document.execCommand('insertText', false, text);
}

function makesection_ja_text_sankou()
{
var selObj = window.getSelection(); 
//var a=selObj.split("\n");
var text="{section start-ja-参考}\n"+selObj+"\n{section sankou end-ja}\n";
document.execCommand('insertText', false, text);
}

//----------------------------------------

function makesection_th_text_chuui()
{
var selObj = window.getSelection(); 
//var a=selObj.split("\n");
var text="{section start-th-ข้อควรทราบ}\n"+selObj+"\n{section chuui end-th}\n";
document.execCommand('insertText', false, text);
}

function makesection_th_text_sankou()
{
var selObj = window.getSelection(); 
//var a=selObj.split("\n");
var text="{section start-th-ข้อมูลเพิ่มเติม}\n"+selObj+"\n{section sankou end-th}\n";
document.execCommand('insertText', false, text);
}




function list()
{
document.execCommand("insertHTML", false, "&nbsp; &nbsp;<img src='https://scdn.line-apps.com/lan/image/line/ios/ja/helpArticle/arrow-right_regular_20230516.png' style='width: 10px; vertical-align: middle'>");
//https://scdn.line-apps.com/lan/image/line/ios/ja/helpArticle/arrow-right_regular_20230516.png" style="width: 10px; vertical-align: middle 
//style='width: 10px; vertical-align: middle'>
}

function midashi12()
{
var selObj = window.getSelection(); 
var text="{{--見出し③12pt : "+selObj+"--}}";
document.execCommand('insertText', false, text);
}

function midashi14()
{
var selObj = window.getSelection(); 
var text="{{--見出し②14pt : "+selObj+"--}}";
document.execCommand('insertText', false, text);
}

function midashi16()
{
var selObj = window.getSelection(); 
var text="{{--見出し①16pt : "+selObj+"--}}";
document.execCommand('insertText', false, text);
}

function acco()
{
var selObj = window.getSelection(); 
var text="{{▼"+selObj+"}}";
document.execCommand('insertText', false, text);

}

function acco2()
{
var selObj = window.getSelection(); 
var text="{{▶"+selObj+"}}";
document.execCommand('insertText', false, text);
}

function acco3()
{
var selObj = window.getSelection(); 
var text="{{●"+selObj+"}}";
document.execCommand('insertText', false, text);
}


function kaigyoukatto()
{
var katto=document.getElementById("Text_textarea").value;
var katto=katto.replace(/\n\n/g,"\n");

document.getElementById("Text_textarea").value=katto;
}

function mouseposition(event)
{
mousex = event.clientX;
mousey = event.clientY;
}

(function(){
  var myContextMenu = document.getElementById('js-contextmenu');
  document.body.addEventListener('contextmenu',function(e){
    var showX = e.pageX;
    var showY = e.pageY;

 if (e.pageY > 100) {
        showY = showY-100;
    } 

    myContextMenu.style.left = mousex+'px';
    myContextMenu.style.top = mousey-150+'px';
    myContextMenu.classList.add('show');
  });
  document.body.addEventListener('click',function(){
    if(myContextMenu.classList.contains('show')) {
      myContextMenu.classList.remove('show');
    }
  })
}());


function link2()
{
b=prompt('URLを入力してください target="_blank" 記載あり',"https://");

var html = getSelectedHtml();

var selObj2 = '<a href="'+b+'" target="_blank">'+html+'</a>'; 

//var selObj = window.getSelection(); 
//var selObj2 = selObj;

document.execCommand('insertHTML', false, selObj2);
editor.setValue(document.getElementById("Preview_p").innerHTML);
//htmlhanei();

}



function texttoHTML()
{
//document.getElementById("HTML_textarea").value=document.getElementById("Preview_p").innerHTML;

editor.setValue(document.getElementById('Preview_p').innerHTML);
updateCounts();

}

function jidouka()
{


//text_to_html();

mongonTH();

//update link and image 
updateCounts();


var a=editor.getValue();

var a=a.replace(/{{●/g,"<details><summary><span style=\"color: rgb\(39, 85, 172\);\">");
var a=a.replace(/{{▶/g,"<details><summary><span style=\"color: rgb\(39, 85, 172\);\">");
var a=a.replace(/{{▼/g,"<details><summary><b><span style=\"color: rgb\(39, 85, 172\);\">");
var a=a.replace(/}}/g,"</span></b></summary>");
var a=a.replace(/{end1}/g,"</details>");
var a=a.replace(/{end2}/g,"</details>");
var a=a.replace(/{end3}/g,"</details>");

var a=a.replace(/{┌----------------------2start----------------------┐}/g,"<div style=\"text-align: left; margin-left: 20px;\" align=\"left\">");
var a=a.replace(/{└----------------------2end----------------------┘}/g,"</div>");
var a=a.replace(/{┌----------------------3start----------------------┐}/g,"<div style=\"text-align: left; margin-left: 30px;\" align=\"left\">");
var a=a.replace(/{└----------------------3end----------------------┘}/g,"</div>");

var a=a.replace(/<\/summary><br>/g,"</summary>");
var a=a.replace(/<\/details><br>/g,"</details>");
var a=a.replace(/<\/details><\/div><br>/g,"</details></div>");
var a=a.replace(/<\/details><\/div><\/div><br>/g,"</details></div></div>");

var a=a.replace(/<b><b>/g,"<b>");
var a=a.replace(/<\/b><\/b>/g,"<\/b>");


//---------------section ja - 注意
var a=a.replace(/{section start-ja-注意}/g,"<div style=\"padding: 10px; margin: 10px 0; border: 1px solid #FF6666; background-color: rgba(255, 0, 0, 0.1);\"> <div style=\"display: flex; align-items: center; justify-content: flex-start;\"><img src=\"https://scdn.line-apps.com/lan/image/line/android/ja/helpArticle/exclamation-triangle_regular_android_jp.png\" style=\"width: 25px;\"><span style=\" font-size: 14pt; color: rgb(0, 0, 0);\">&nbsp;注意</span><br></div><font color=\"#000000\">");
var a=a.replace(/注意<\/span><br><\/div><font color=\"\#000000\"><br>/g,"注意</span><br></div><font color=\"#000000\">");

var a=a.replace(/{section chuui end-ja}/g,"</font></div>");

//---------------section ja - 注意 end


//---------------section ja - 参考
var a=a.replace(/{section start-ja-参考}/g,"<div style=\"padding: 10px; margin: 10px 0; border: 1px solid #06C755; background-color: rgba(6, 199, 85, 0.1);\"><div style=\"display: flex; align-items: center; justify-content: flex-start;\"><img src=\"https://scdn.line-apps.com/lan/image/line/android/ja/helpArticle/info-circle_regular_android_jp.png\" style=\"width: 25px;\"><span style=\" font-size: 14pt; color: rgb(0, 0, 0);\">&nbsp;参考</span><br></div><font color=\"#000000\">");
var a=a.replace(/参考<\/span><br><\/div><font color=\"\#000000\"><br>/g,"参考</span><br></div><font color=\"#000000\">");


//---------------section ja - 参考 end

var a=a.replace(/{section sankou end-ja}/g,"</font></div>");


//■■■■■■■■■■■■■■TH■■■■■■■■■■■■

//---------------section th - 注意
var a=a.replace(/{section start-th-ข้อควรทราบ}/g,"<div style=\"padding: 10px; margin: 10px 0; border: 1px solid #FF6666; background-color: rgba(255, 0, 0, 0.1);\"> <div style=\"display: flex; align-items: center; justify-content: flex-start;\"><img src=\"https://scdn.line-apps.com/lan/image/line/android/ja/helpArticle/exclamation-triangle_regular_android_jp.png\" style=\"width: 25px;\"><span style=\"font-size: 14pt;color: rgb(0, 0, 0);\">&nbsp;ข้อควรทราบ :</span><br></div><font color=\"#000000\">");

var a=a.replace(/ข้อควรทราบ :<\/span><br><\/div><font color=\"\#000000\"><br>/g,"ข้อควรทราบ :</span><br></div><font color=\"#000000\">");

var a=a.replace(/{section chuui end-th}/g,"</font></div>");

//---------------section th - 注意 end


//---------------section th - 参考
var a=a.replace(/{section start-th-ข้อมูลเพิ่มเติม}/g,"<div style=\"padding: 10px; margin: 10px 0; border: 1px solid #06C755; background-color: rgba(6, 199, 85, 0.1);\"><div style=\"display: flex; align-items: center; justify-content: flex-start;\"><img src=\"https://scdn.line-apps.com/lan/image/line/android/ja/helpArticle/info-circle_regular_android_jp.png\" style=\"width: 25px;\"><b><span style=\"color: rgb(0, 0, 0);\">&nbsp;ข้อมูลเพิ่มเติม :</span></b><br></div><font color=\"#000000\">");
var a=a.replace(/ข้อมูลเพิ่มเติม :<\/span><\/b><br><\/div><font color=\"\#000000\"><br>/g,"ข้อมูลเพิ่มเติม :</span></b><br></div><font color=\"#000000\">");

//---------------section th - 参考 end

var a=a.replace(/{section sankou end-th}/g,"</font></div>");


document.getElementById('Preview_p').innerHTML=a;

//document.getElementById('HTML_textarea').value=document.getElementById('Preview_p').innerHTML;
editor.setValue(document.getElementById('Preview_p').innerHTML);

//var d=document.getElementById('HTML_textarea').value;
//var d=d.replace(/<details>/g,"<details>\n");
//var d=d.replace(/<\/details>/g,"<\/details>\n");

}

function mongonTH()
{

var c=document.getElementById('Text_textarea').value;

var c=c.replace(/&/g,"&amp;");
var c=c.replace(/</g,"&lt;");
var c=c.replace(/>/g,"&gt;");



var c=c.replace(/\nรายการคำถาม :\n\(q-start\)/g,"\(q-start\)\nรายการคำถาม :");
//var c=c.replace(/\(\/q-end\)\n/g,"\(\/q-end\)");

var c=c.replace(/\n</g,"\n<b><");
var c=c.replace(/>\n/g,"></b>\n");
var c=c.replace(/\n/g,"<br>");

var c=c.replace(/"/g,"</b>\"");
var c=c.replace(/ <\/b>"/g," \"<b>");
var c=c.replace(/\( \)/g,"\(&nbsp; \)");
var c=c.replace(/รายการคำถาม :/g,"<b>รายการคำถาม :</b>");
var c=c.replace(/\"<b>URL สำหรับตอบกลับ<\/b>\"/g,"\"URL สำหรับตอบกลับ\"");
var c=c.replace(/ <br>/g,"<br>");
var c=c.replace(/"<b> ≡ "<b>/g,"\"<b> ≡ <\/b>\"");
var c=c.replace(/"<b> V "<b>/g,"\"<b> V <\/b>\"");
var c=c.replace(/<br><br><br>/g,"<br><br>");
var c=c.replace(/LINE ให้เป็นเวอร์ชันล่าสุด ที่นี่/g,"LINE ให้เป็นเวอร์ชันล่าสุด <a href=\"https://line.me/update\">ที่นี่</a>");
var c=c.replace(/ไปที่หน้าการตั้งค่า/g," <a href=\"https://line.me/R/nv/settings/\">ไปที่หน้าการตั้งค่า</a>");
var c=c.replace(/- วิธีการแก้ไขเบื้องต้น/g,"- <a href=\"https://help.line.me/line/?contentId=20000199\">วิธีการแก้ไขเบื้องต้น</a>");
var c=c.replace(/"<b> T "<b>/g,"\"<b> T <\/b>\"");
var c=c.replace(/วิธีการแก้ไขปัญหาเบื้องต้น :/g,"<b><font color=\"#00b050\">วิธีการแก้ไขปัญหาเบื้องต้น :<\/font><\/b>");
var c=c.replace(/"<b> ↓ "<b>/g,"\"<b>  ↓ <\/b>\"");
var c=c.replace(/หมายเหตุ:/g,"<b>หมายเหตุ:<\/b>");
var c=c.replace(/"<b> X "<b>/g,"\"<b>  X <\/b>\"");

var c=c.replace(/<br>&lt;/g,"<br><b>&lt;");
var c=c.replace(/&gt;<br>/g,"&gt;</b><br>");

var c=c.replace(/<br>/g,"<br>\n");

//JP------------------------------------
var c=c.replace(/\[/g,"<b>[");
var c=c.replace(/\]/g,"]</b>");

//TW------------------------------------
var c=c.replace(/「/g,"<b>「");
var c=c.replace(/」/g,"」</b>");


//CN------------------------------------
var c=c.replace(/［/g,"<b>［");
var c=c.replace(/］/g,"］</b>");

//--------------------見出しセット
var c=c.replace(/{{--見出し③12pt : /g,"<b><span style=\"font-size: 12pt; color: rgb(0, 0, 0);\">");
var c=c.replace(/{{--見出し②14pt : /g,"<b><span style=\"font-size: 14pt; color: rgb(0, 0, 0);\">");
var c=c.replace(/{{--見出し①16pt : /g,"<b><span style=\"font-size: 16pt; color: rgb(0, 0, 0);\">");
var c=c.replace(/--}}/g,"</span></b>");


//escape charecters
//ทำไม่ได้พังหมดเลย
//var c=c.replace(/</g,"&lt;");
//var c=c.replace(/>/g,"&gt;");
//var c=c.replace(/&/g,"&amp;");




//document.getElementById('HTML_textarea').value=c;
editor.setValue(c);
document.getElementById('Preview_p').innerHTML=editor.getValue();


}

function text_to_html()
{
var c=document.getElementById("Text_textarea").value;
var c=c.replace(/\n</g,"\n<b><");
var c=c.replace(/>\n/g,"></b>\n");
var c=c.replace(/\n/g,"<br>");
var c=c.replace(/　/g,"&nbsp; ");


document.getElementById("Preview_p").innerHTML=c;
//document.getElementById("HTML_textarea").value=document.getElementById("Preview_p").innerHTML;
editor.setValue(document.getElementById('Preview_p').innerHTML);


//var d=document.getElementById("HTML_textarea").value;
var  d=editor.getValue()

var d=d.replace(/<br>/g,"<br>\n");
//document.getElementById("HTML_textarea").value=d;
editor.setValue(d);
}

function htmlhanei()
{
document.getElementById("Preview_p").innerHTML=editor.getValue();
  addEventListenersToContent();
  hideTooltip();
  updateCounts();
 
}


function closepostit()
{
document.getElementById("mydiv").style.display="none";
//document.getElementById("risuto").style.display="none";
document.getElementById("iframe_head").contentDocument.location.reload(true);

}

function openpostit()
{
document.getElementById("mydiv").style.display="block";
}


</script>


<style>
#mydiv {
  position: absolute;
  z-index: 9;
  background-color: #f1f1f1;
  text-align: center;
  border: 1px solid black;
}

#mydivheader {
  padding: 10px;
  cursor: move;
  z-index: 10;
  background-color: green;
  color: #fff;
}
</style>
<body>



<script>
//Make the DIV element draggagle:
dragElement(document.getElementById("mydiv"));

function dragElement(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  if (document.getElementById(elmnt.id + "header")) {
    /* if present, the header is where you move the DIV from:*/
    document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
  } else {
    /* otherwise, move the DIV from anywhere inside the DIV:*/
    elmnt.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    /* stop moving when mouse button is released:*/
    document.onmouseup = null;
    document.onmousemove = null;
  }
}

//memo:
//2023/05/25 15:27 KOの
</script>


<script>
function copyRichText() {
  // Get the editable div
  var editableDiv = document.getElementById('Preview_p');
  
  // Clone the editable div
  var cloneDiv = editableDiv.cloneNode(true);
  
  // Remove font-size and font-family styles from the clone
  Array.from(cloneDiv.querySelectorAll('*')).forEach(function(element) {
    element.style.fontSize = ''; // Remove font size
    element.style.fontFamily = ''; // Remove font family
  });

  // Append the clone to the body temporarily and make it off-screen
  cloneDiv.style.position = 'absolute';
  cloneDiv.style.left = '-9999px';
  document.body.appendChild(cloneDiv);

  // Select the content inside the clone
  var range = document.createRange();
  range.selectNodeContents(cloneDiv);
  var selection = window.getSelection();
  selection.removeAllRanges(); // Clear any existing selections
  selection.addRange(range); // Select the text in the range

  // Execute the copy command
  var successful = document.execCommand('copy');
  var msg = successful ? 'successful' : 'unsuccessful';
  console.log('Copy command was ' + msg);

  // Deselect the text and remove the clone from the body
  selection.removeAllRanges();
  document.body.removeChild(cloneDiv);
}
</script>

<script>

//__________________________________________________________________________________

  document.getElementById("replaceButton").addEventListener("click", function() {
    	
	var aa=document.getElementById("Text_textarea").value;
	
	var aa=aa.replace(/▼/g,"");
	var aa=aa.replace(/▽/g,"");
	var aa=aa.replace(/⇒/g,"");
	
	var aa=aa.replace(/\/\//g,"");
	
	//var aa=aa.replace(/-/g,"");
	
	var aa=aa.replace(/<\/b>><b>/g,"</b>&gt;<b>");
	
	
	var aa=aa.replace(/<b>/g,"");
	var aa=aa.replace(/<\/b>/g,"");
	var aa=aa.replace(/\[/g,"<b>[");
	
	var aa=aa.replace(/\[/g,"<b>[");
	var aa=aa.replace(/\]/g,"]</b>");
	
	//tw用
	var aa=aa.replace(/\「/g,"<b>「");
	var aa=aa.replace(/\」/g,"」</b>");
	
	
	//CN用
	var aa=aa.replace(/\［/g,"<b>［");
	var aa=aa.replace(/\］/g,"］</b>");
	
	//tobedone-done
	var aa=aa.replace(/To be checked/g,"Done");
	var aa=aa.replace(/To be done/g,"Done");
	
	
	
	var aa=aa.replace(/"/g,"</b>\"");
    var aa=aa.replace(/ <\/b>"/g," \"<b>");
	
	var aa=aa.replace(/<b><b>/g,"<b>");
	
	document.getElementById("Text_textarea").value=aa;
	
	const leftText = document.getElementById("Text_textarea").value;
    const rightText = editor.getValue();
	//const rightText = document.getElementById("outputText").value;
	
    // Extracting Japanese and Thai sentences based on the pattern from the left textarea
    const pattern = /(\d+\n[\s\S]+?)Done/g;
    let match;
    let replacements = {};

    while ((match = pattern.exec(leftText)) !== null) {
      const [fullMatch, content] = match;
      const [japanese, thai] = content.split('\n').map(line => line.trim()).filter(line => line && !line.match(/^\d+$/) && line !== 'Done');
      replacements[japanese] = thai;
    }

    // Replacing Japanese text with Thai in the right textarea
    let replacedText = rightText;
    for (const [japanese, thai] of Object.entries(replacements)) {
      replacedText = replacedText.replace(japanese, thai);
    }

editor.setValue(replacedText);
htmlhanei();
addEventListenersToContent();
    //document.getElementById("outputText").value = replacedText;
  });
  
  
  //__________________________________________________________________________________
  document.getElementById("replaceButtonshudou").addEventListener("click", function() {
    	
	var aa=document.getElementById("Text_textarea").value;
	
	var aa=aa.replace(/▼/g,"");
	var aa=aa.replace(/\/\//g,"");
	
		//tobedone-done
	var aa=aa.replace(/To be checked/g,"Done");
	var aa=aa.replace(/To be done/g,"Done");
		
	document.getElementById("Text_textarea").value=aa;
	
	const leftText = document.getElementById("Text_textarea").value;
    const rightText = editor.getValue();
	//const rightText = document.getElementById("outputText").value;
	
    // Extracting Japanese and Thai sentences based on the pattern from the left textarea
    const pattern = /(\d+\n[\s\S]+?)Done/g;
    let match;
    let replacements = {};

    while ((match = pattern.exec(leftText)) !== null) {
      const [fullMatch, content] = match;
      const [japanese, thai] = content.split('\n').map(line => line.trim()).filter(line => line && !line.match(/^\d+$/) && line !== 'Done');
      replacements[japanese] = thai;
    }

    // Replacing Japanese text with Thai in the right textarea
    let replacedText = rightText;
    for (const [japanese, thai] of Object.entries(replacements)) {
      replacedText = replacedText.replace(japanese, thai);
    }

editor.setValue(replacedText);
htmlhanei();
    //document.getElementById("outputText").value = replacedText;
  });

  //__________________________________________________________________________________  
  
  

 function removeAllStylesAndCleanUp() {
            const htmlInput = editor.getValue();
			
            // Remove all inline style attributes
            let processedHtml = htmlInput.replace(/style="[^"]*"/gi, '');

            // Remove all span tags entirely
            processedHtml = processedHtml.replace(/<\/?span[^>]*>/gi, '');

            // Change <br style=""> to <br>
            processedHtml = processedHtml.replace(/<br\s*\/?>/gi, '<br>');

            // Update the output textarea
			var a= processedHtml.trim();
            editor.setValue(a);
        }


function mojisuukei(){

var moji=document.getElementById("Text_textarea").value;
var moji4=moji.replace(/ /g,"");
var moji4=moji4.replace(/	/g,"");

var moji2=moji.split("\n");
var moji5=moji.split(" ");

var moji3=moji2.length;
var moji6=moji5.length;
var len = moji4.length-moji3+1;


var spaces = moji.match(/\S+/g);

  let words;
  if (spaces) {
    words = spaces.length;
  } else {
    words = 0;
  }

document.getElementById("mojisuu").innerHTML="文字数："+"<b>"+len+"字"+"</b>"+" / "+"語数："+"<b>"+words+"語"+"</b>";

}

function shousaisakujo()
{
var a = editor.getValue();
var a=a.replace(/<\/details><details>/g,"");
var a=a.replace(/<\/details><details open=\"\">/g,"");

var a=a.replace(/<b><span style=\"font-size\: 12pt; color\: rgb\(0, 0, 0\);\">-<\/span><\/b>/g,"");

editor.setValue(a);

document.getElementById("Preview_p").innerHTML=editor.getValue();

}

function shinsection()
{
var a=document.getElementById("Preview_p").innerHTML;

var a=a.replace(/#FF6666/g,"#e7d38d")
var a=a.replace(/rgba\(255, 0, 0, 0.1\)/g,"#fffef7")
var a=a.replace(/android\/ja\/helpArticle\/exclamation-triangle_regular_android_jp.png/g,"smartphone/en/helpArticle/lds_exclamation-triangle_solid.png");
var a=a.replace(/android\/ja\/helpArticle\/info-circle_regular_android_jp.png/g,"smartphone/en/helpArticle/lds_info-circle_solid.png");



document.getElementById("Preview_p").innerHTML=a;
editor.setValue(a);
}


function THka()
{
var a=document.getElementById("Preview_p").innerHTML;
var a=a.replace(/font-size: 12pt;/g,"")
var a=a.replace(/font-size: 14pt;/g,"font-size: 12pt;")
var a=a.replace(/font-size: 16pt;/g,"font-size: 12pt;")
var a=a.replace(/alt="ข้อมูลเพิ่มเติม :"/g,"")
var a=a.replace(/&nbsp;ข้อมูลเพิ่มเติม :/g,"<b>&nbsp;ข้อมูลเพิ่มเติม :</b>")
var a=a.replace(/<b><span style=" color: rgb(0, 0, 0);">-<\/span><\/b><br>/g,"")
var a=a.replace(/alt="ข้อควรทราบ :"/g,"")


document.getElementById("Preview_p").innerHTML=a;
editor.setValue(a);

}


// for link and image function

        document.getElementById('editor').addEventListener('input', updateCounts);
        document.getElementById('linkIcon').addEventListener('mouseover', showLinks);
        document.getElementById('imgIcon').addEventListener('mouseover', showImages);

        function updateCounts() {
            const text = editor.getValue();

            const linkCount = (text.match(/<a[^>]*>.*?<\/a>/gi) || []).length;
            document.getElementById('urlcount').innerText = linkCount;

            const imgCount = (text.match(/<img [^>]*src="([^"]*)"/gi) || []).length;
            document.getElementById('imgcount').innerText = imgCount;
        }

        function showLinks() {
            const text = editor.getValue();;
            const links = text.match(/<a[^>]*>.*?<\/a>/gi) || [];
            const linkList = document.getElementById('linkList');
            linkList.innerHTML = '';

            if (links.length > 0) {
                links.forEach(link => {
                    const linkTextMatch = link.match(/>(.*?)<\/a>/);
                    const hrefMatch = link.match(/href="([^"]*)"/);
                    const nameMatch = link.match(/name="([^"]*)"/);

                    const linkText = linkTextMatch ? linkTextMatch[1] : 'No Text';
                    const hrefOrName = hrefMatch ? hrefMatch[1] : (nameMatch ? nameMatch[1] : '');

                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>${linkText}</strong> : <br>${hrefOrName}`;
                    linkList.appendChild(listItem);
                });
            } else {
                linkList.innerHTML = '<li>No links</li>';
            }
        }

        function showImages() {
            const text = editor.getValue();;
            const images = text.match(/<img [^>]*src="([^"]*)"[^>]*>/gi) || [];
            const imgList = document.getElementById('imgList');
            imgList.innerHTML = '';

            if (images.length > 0) {
                images.forEach(imgTag => {
                    const srcMatch = imgTag.match(/src="([^"]*)"/);
                    const altMatch = imgTag.match(/alt="([^"]*)"/);
                    const styleMatch = imgTag.match(/style="([^"]*)"/);

                    const src = srcMatch ? srcMatch[1] : '';
                    const alt = altMatch ? altMatch[1] : 'No alt';
                    const style = styleMatch ? styleMatch[1] : 'max-width:100%; height:auto;';

                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <img alt="${alt}" src="${src}" style="${style}">
                        <span>&lt;img alt="${alt}" src="${src}" style="${style}"&gt;</span>`;
                    
                    imgList.appendChild(listItem);
                });
            } else {
                imgList.innerHTML = '<li>No images</li>';
            }
        }
  
  
        //  -------------------link popup--------------------------

</script>

    <style>
        #editable-div {
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 150px;
            margin-bottom: 20px;
            
        }
        #popup_link {
            display: none;
            position: fixed;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            /* padding-right: 25px; */
            
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width:300px;
            border-radius: 2%;

        }
        #popup_link label,
        #popup_link input {
            display: block;
            margin: 5px 0;
            width: 100%;
        }
        #popup_link input {
            padding: 5px;
        }
        #popup_link .button-row {
            display: flex;
            justify-content: left;
            margin-top: 10px;
        }
        #open-link {
            margin-left: 5px;
        }

        .checkbox-row {
            display: flex;
            align-items: left;
            text-align: left;
            justify-content: left
            
    </style>

    
</div>


<div id="popup_link">
    <label for="title-input" style="text-align: left;">Title:</label>
    <input type="text" id="title-input">
    <div class="checkbox-row" style="text-align: left;">
      Enter URL: &nbsp;&nbsp;&nbsp; <input type="checkbox" id="target-blank-checkbox" style="width:20px">&nbsp;target = "_blank"
            
    </div>
    <input type="text" id="url-input">
    
        <button id="create-link">Insert</button>&nbsp;
        <button id="close-popup">Cancel</button>
        <button id="open-link" disabled>Open</button>
    </div>
</div>

<script>
    const linkButton = document.getElementById('link-button');
    const popup_link = document.getElementById('popup_link');
    const urlInput = document.getElementById('url-input');
    const titleInput = document.getElementById('title-input');
    const targetBlankCheckbox = document.getElementById('target-blank-checkbox');
    const createLinkButton = document.getElementById('create-link');
    const closePopupButton = document.getElementById('close-popup');
    const openLinkButton = document.getElementById('open-link');
    const editableDiv = document.getElementById('Preview_P');
    let selectedTextRange;
    let currentLink;

    linkButton.addEventListener('click', () => {
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            selectedTextRange = selection.getRangeAt(0);
            if (!selectedTextRange.collapsed) {
                titleInput.value = selectedTextRange.toString();
                showPopup();
            }
        }
    });

    createLinkButton.addEventListener('click', insertOrUpdateLink);

    [urlInput, titleInput].forEach(input => {
        input.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                insertOrUpdateLink();
                editor.setValue(document.getElementById('Preview_p').innerHTML);
            }
        });
    });

    closePopupButton.addEventListener('click', closePopup);

    urlInput.addEventListener('input', () => {
        openLinkButton.disabled = !urlInput.value.trim();
    });

    openLinkButton.addEventListener('click', () => {
        const url = urlInput.value.trim();
        if (url) {
          window.open(url, '_blank');

        }
    });

    Preview_p.addEventListener('dblclick', (event) => {
        if (event.target.tagName.toLowerCase() === 'a') {
            currentLink = event.target;
            urlInput.value = currentLink.href;
            titleInput.value = currentLink.textContent;
            openLinkButton.disabled = !urlInput.value.trim();
            const rect = currentLink.getBoundingClientRect();
            popup_link.style.top = `${rect.top + window.scrollY + 20}px`;
            popup_link.style.left = `${rect.left + window.scrollX}px`;
            popup_link.style.display = 'block';
            urlInput.focus();
            editor.setValue(document.getElementById('Preview_p').innerHTML);
            //htmlhanei();
        }
    });

    //window.addEventListener('click', (event) => {
      //  if (!popup_link.contains(event.target) && event.target !== linkButton) {
        //    closePopup();
        //}
    //});

    function showPopup() {
        if (selectedTextRange) {
            const rect = selectedTextRange.getBoundingClientRect();
            popup_link.style.top = `${rect.top + window.scrollY + 20}px`;
            popup_link.style.left = `${rect.left + window.scrollX}px`;
        }
        popup_link.style.display = 'block';
        urlInput.value = '';
        titleInput.value = titleInput.value || '';
        openLinkButton.disabled = true;
        targetBlankCheckbox.checked = false;
        urlInput.focus();
    }

    function closePopup() {
        popup_link.style.display = 'none';
        urlInput.value = '';
        titleInput.value = '';
        currentLink = null;
    }

    function insertOrUpdateLink() {
        const url = urlInput.value.trim();
        const title = titleInput.value.trim();

        if (currentLink) {
            if (url) {
                currentLink.href = url;
                currentLink.textContent = title || currentLink.textContent;
                if (targetBlankCheckbox.checked) {
                    currentLink.setAttribute('target', '_blank');
                } else {
                    currentLink.removeAttribute('target'); // Remove target if not checked
                }
            } else {
                currentLink.replaceWith(currentLink.textContent);
            }
        } else if (url && selectedTextRange) {
            const a = document.createElement('a');
            a.href = url;
            a.textContent = title || selectedTextRange.toString();
            if (targetBlankCheckbox.checked) {
                a.setAttribute('target', '_blank');
            }
            selectedTextRange.deleteContents();
            selectedTextRange.insertNode(a);
            selectedTextRange = null;
            
        }

        editor.setValue(document.getElementById('Preview_p').innerHTML);
        //htmlhanei();

        currentLink = null;
        closePopup();
               

    }
</script>

</body>
</html>
